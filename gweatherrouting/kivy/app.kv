#:kivy 1.0

#:import name gweatherrouting.kivy.gribscreen
##:include gweatherrouting/kivy/gribscreen.kv
<LocalGribListItem>:
    IconLeftWidget:
        icon: root.icon

    RightBody:
        orientation: 'horizontal'

        MDIconButton:
            icon: 'delete'
            margin_right: dp(10)
            on_release: root.remove()

        MDCheckbox:
            active: root.active
            on_active:
                root.active = self.active
                root.setEnabled(self.active)

<RemoteGribListItem>:
    on_press: root.callback(self.url)

    IconLeftWidget:
        icon: "tailwind"


<GribScreen>:
    MDProgressBar:
        id: downloadProgress
        value: 0
        pos_hint: { 'bottom': 1 }

    ScrollView:            
        MDList:
            id: gribList

    MDFloatingActionButton:
        icon: "cloud-download"
        elevation_normal: 12
        pos_hint: {'right': 1, 'bottom': 0.86}
        md_bg_color: app.theme_cls.primary_color
        on_release: root.openGribDownloadDialog()


    # MDFloatingActionButton:
    #     icon: "folder-open"
    #     elevation_normal: 12
    #     pos_hint: {'center_x': .6, 'bottom': 0.86 }
    #     md_bg_color: app.theme_cls.primary_color
    #     on_release: root.openGribDownloadDialog()


#:import name gweatherrouting.kivy.trackscreen
##:include gweatherrouting/kivy/trackscreen.kv
<TrackListItem>:
    IconLeftWidget:
        icon: 'map-marker-path'

    RightCheckbox:
        active: root.visible
        # on_active:
        #     root.active = self.active
        #     root.setEnabled(self.active)

<POIListItem>:
    IconLeftWidget:
        icon: 'map-marker'

    RightCheckbox:
        active: root.visible
        # on_active:
        #     root.active = self.active
        #     root.setEnabled(self.active)

<TrackScreen>:
    ScrollView:
        MDList:
            id: trackList


#:import name gweatherrouting.kivy.settingsscreen
##:include gweatherrouting/kivy/settingsscreen.kv
<SettingsScreen>:
    ScrollView:

#:import name gweatherrouting.kivy.regattascreen
##:include gweatherrouting/kivy/regattascreen.kv
<RegattaScreen>:
    MDTabs:
        Tab:
            title: "Map"
            content_text: f"This is an example text for {self.title}"

        Tab:
            title: "Gauges"
            content_text: f"This is an example text for {self.title}"

        Tab:
            title: "Logs"
            content_text: f"This is an example text for {self.title}"

        Tab:
            title: "Parameters"
            content_text: f"This is an example text for {self.title}"


#:import name gweatherrouting.kivy.timepickerdialog
##:include gweatherrouting/kivy/timepickerdialog.kv
<TimePickerDialogContent>:
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "120dp"

    MDBoxLayout:
        orientation: "horizontal"

        MDLabel:
            id: dateLabel
            text: root.datetime.strftime("%m/%d/%Y")

        MDRaisedButton:
            text: "Set date"
            on_press: root.openDatePicker()

    MDBoxLayout:
        orientation: "horizontal"

        MDLabel:
            id: timeLabel
            text: root.datetime.strftime("%H:%M:%S")

        MDRaisedButton:
            text: "Set time"
            on_press: root.openTimePicker()

MDScreen:
    id: mainScreen

    MDToolbar:
        id: toolbar
        title: "GWR"
        pos_hint: {"top": 1}
        elevation: 10
        md_bg_color: app.theme_cls.accent_color
        right_action_items: [["dots-vertical", lambda x: app.callback()]]
        left_action_items: [["menu", lambda x: navDrawer.set_state("open")]]

    # MDBottomAppBar:
    #     MDToolbar:
    #         title: "Title"
    #         icon: "git"
    #         type: "bottom"
    #         left_action_items: [["menu", lambda x: x]]
    #         on_action_button: app.callback(self.icon)

    MDNavigationLayout:
        y: toolbar.height
        size_hint_y: None
        height: root.height - toolbar.height

        ScreenManager:
            id: screenManager

            MDScreen:
                name: "Map Screen"
                id: mapScreen

                MDBoxLayout:
                    orientation: "vertical"

                    MDBoxLayout:
                        size_hint_y: None
                        height: "50dp"
                        orientation: "horizontal"

                        MDIconButton:
                            icon: "step-backward-2"
                            user_font_size: "28sp"
                            on_press: app.onBackwardClick(hours=12)

                        MDIconButton:
                            icon: "step-backward"
                            user_font_size: "28sp"
                            on_press: app.onBackwardClick(hours=1)

                        MDIconButton:
                            icon: "step-forward"
                            user_font_size: "28sp"
                            on_press: app.onForwardClick(hours=1)

                        # MDIconButton:
                        #     icon: "play"
                        #     user_font_size: "28sp"
                        #     on_press: app.onPlayClick()

                        MDIconButton:
                            icon: "step-forward-2"
                            user_font_size: "28sp"
                            on_press: app.onForwardClick(hours=12)

                        MDIconButton:
                            icon: "clock"
                            user_font_size: "28sp"
                            on_press: app.openTimePickerDialog()

                        MDLabel:
                            pos_hint: {"right": 1}
                            id: timeLabel
                            text: str(app.timeControl.time)


                    MapView
                        id: mapView
                        zoom:   8
                        lat:    39
                        lon:    9

                        on_touch_up: app.onMapTouchDown(args)

            GribScreen:
                name: "Grib Screen"
                id: gribScreen


            TrackScreen:
                name: "Track Screen"
                id: trackScreen

            MDScreen:
                name: "Routings Screen"
                id: routingScreen

                MDLabel:
                    text: "Screen 2"
                    halign: "center"

            RegattaScreen:
                name: "Settings Screen"
                id: regattaScreen

            SettingsScreen:
                name: "Settings Screen"
                id: settingsScreen


        MDNavigationDrawer:
            id: navDrawer

            MDBoxLayout:
                orientation: "vertical"
                padding: "8dp"
                spacing: "8dp"

                ScrollView:
                    MDList:
                        id: drawerList

                        OneLineListItem:
                            text: "Map"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = mapScreen.name

                            IconLeftWidget:
                                icon: "map"
                                theme_text_color: "Custom"
                                text_color: app.theme_cls.accent_color

                        OneLineListItem:
                            text: "Regatta"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = regattaScreen.name

                            IconLeftWidget:
                                icon: "plus"

                        OneLineListItem:
                            text: "Gribs"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = gribScreen.name

                            IconLeftWidget:
                                icon: "language-python"

                        OneLineListItem:
                            text: "Tracks & POIs"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = trackScreen.name
                            
                            IconLeftWidget:
                                icon: "minus"

                        OneLineListItem:
                            text: "Routings"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = routingScreen.name

                            IconLeftWidget:
                                icon: "plus"

                        OneLineListItem:
                            text: "Settings"

                            on_press:
                                root.ids.navDrawer.set_state("close")
                                root.ids.screenManager.current = settingsScreen.name

                            IconLeftWidget:
                                icon: "map"